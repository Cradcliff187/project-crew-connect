# Schema Map for Reports

This document outlines the database tables and their structures relevant to the reports section rebuild.

## Relevant Tables

Based on initial investigation, the following tables seem relevant:

- `projects`
- `customers`
- `vendors`
- `subcontractors`
- `maintenance_work_orders` (Work Orders)
- `estimates`
- `expenses` (Primary Expense Table?)
- `time_entries`
- `change_orders` (Primary Change Order Table?)
- `employees`
- `estimate_items`
- `project_budget_items`
- `contacts`
- `project_change_orders` (Secondary CO Table?)
- `project_expenses` (Secondary Expense Table?)

---

## Table Structures

### `projects`

- `projectid`: text (NO)
- `customerid`: text (YES)
- `projectname`: text (YES)
- `status`: text (YES)
- `createdby`: text (YES)
- `description`: text (YES)
- `site_address`: text (YES)
- `site_city`: text (YES)
- `site_state`: text (YES)
- `site_zip`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `target_end_date`: timestamp with time zone (YES)
- `total_budget`: numeric (YES)
- `current_expenses`: numeric (YES)
- `budget_status`: text (YES)
- `original_base_cost`: numeric (YES)
- `original_selling_price`: numeric (YES)
- `original_contingency_amount`: numeric (YES)
- `change_order_cost_impact`: numeric (YES)
- `change_order_selling_price_impact`: numeric (YES)
- `start_date`: timestamp with time zone (YES)
- `contract_value`: numeric (YES)
- `actual_revenue`: numeric (YES)

### `customers`

- `customerid`: text (NO)
- `customername`: text (YES)
- `address`: text (YES)
- `city`: text (YES)
- `state`: text (YES)
- `zip`: text (YES)
- `contactemail`: text (YES)
- `phone`: text (YES)
- `createdon`: timestamp with time zone (YES)
- `createdby`: text (YES)
- `status`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)

### `vendors`

- `vendorid`: text (NO)
- `vendorname`: text (YES)
- `address`: text (YES)
- `city`: text (YES)
- `state`: text (YES)
- `zip`: text (YES)
- `email`: text (YES)
- `phone`: text (YES)
- `createdon`: timestamp with time zone (YES)
- `createdby`: text (YES)
- `status`: text (YES)
- `qbvendortype`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `payment_terms`: character varying (YES)
- `tax_id`: character varying (YES)
- `notes`: text (YES)

### `subcontractors`

- `subid`: text (NO)
- `subname`: text (YES)
- `address`: text (YES)
- `city`: text (YES)
- `state`: text (YES)
- `zip`: text (YES)
- `contactemail`: text (YES)
- `phone`: text (YES)
- `qbvendortype`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `status`: text (YES)
- `specialty_ids`: ARRAY (YES)
- `payment_terms`: character varying (YES)
- `notes`: text (YES)
- `hourly_rate`: numeric (YES)
- `tax_id`: character varying (YES)
- `total_completed_amount`: numeric (YES)
- `insurance_expiration`: timestamp with time zone (YES)
- `insurance_provider`: character varying (YES)
- `insurance_policy_number`: character varying (YES)
- `contract_on_file`: boolean (YES)
- `contract_expiration`: timestamp with time zone (YES)
- `last_performance_review`: timestamp with time zone (YES)
- `rating`: numeric (YES)
- `preferred`: boolean (YES)
- `on_time_percentage`: numeric (YES)
- `quality_score`: numeric (YES)
- `safety_incidents`: integer (YES)
- `response_time_hours`: numeric (YES)

### `maintenance_work_orders` (Work Orders)

- `work_order_id`: uuid (NO)
- `title`: text (NO)
- `description`: text (YES)
- `customer_id`: text (YES)
- `location_id`: uuid (YES)
- `status`: text (YES)
- `priority`: text (YES)
- `assigned_to`: uuid (YES) (FK to `employees.employee_id`)
- `scheduled_date`: timestamp with time zone (YES)
- `completed_date`: timestamp with time zone (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `po_number`: text (YES)
- `time_estimate`: numeric (YES)
- `actual_hours`: numeric (YES)
- `materials_cost`: numeric (YES)
- `total_cost`: numeric (YES)
- `progress`: numeric (NO)
- `project_id`: text (YES) (FK to `projects.projectid`)
- `work_order_number`: text (YES)
- `due_by_date`: timestamp with time zone (YES)

### `estimates`

- `estimateid`: text (NO)
- `projectid`: text (YES) (FK to `projects.projectid`)
- `datecreated`: timestamp with time zone (YES)
- `customerid`: text (YES) (FK to `customers.customerid`)
- `estimateamount`: numeric (YES)
- `contingencyamount`: numeric (YES)
- `createdby`: text (YES)
- `docurl`: text (YES)
- `docid`: text (YES)
- `status`: text (YES)
- `sentdate`: timestamp with time zone (YES)
- `isactive`: boolean (YES)
- `approveddate`: timestamp with time zone (YES)
- `sitelocationaddress`: text (YES)
- `sitelocationcity`: text (YES)
- `sitelocationstate`: text (YES)
- `sitelocationzip`: text (YES)
- `po#`: text (YES)
- `job description`: text (YES)
- `customername`: text (YES)
- `projectname`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `contingency_percentage`: numeric (YES)
- `converted_revision_id`: uuid (YES)

### `expenses` (Primary)

- `id`: uuid (NO)
- `entity_type`: text (NO) (e.g., 'PROJECT', 'WORK_ORDER')
- `entity_id`: text (NO) (FK to `projects.projectid` or `maintenance_work_orders.work_order_id`)
- `parent_expense_id`: uuid (YES)
- `expense_type`: text (YES)
- `description`: text (NO)
- `amount`: numeric (NO)
- `quantity`: numeric (NO)
- `unit_price`: numeric (NO)
- `expense_date`: timestamp with time zone (NO)
- `vendor_id`: text (YES) (FK to `vendors.vendorid`)
- `document_id`: uuid (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `created_by`: text (YES)
- `notes`: text (YES)
- `status`: text (YES)
- `time_entry_id`: uuid (YES) (FK to `time_entries.id`)
- `budget_item_id`: uuid (YES) (FK to `project_budget_items.id`)
- `is_billable`: boolean (YES)
- `is_receipt`: boolean (YES)
- `category`: text (YES)

### `time_entries`

- `id`: uuid (NO)
- `entity_type`: character varying (NO) (e.g., 'work_order', 'project')
- `entity_id`: character varying (NO) (FK to `maintenance_work_orders.work_order_id` or `projects.projectid`)
- `date_worked`: date (NO)
- `start_time`: time without time zone (NO)
- `end_time`: time without time zone (NO)
- `hours_worked`: numeric (NO)
- `employee_id`: uuid (YES) (FK to `employees.employee_id`)
- `employee_rate`: numeric (YES) (Potentially deprecated by `cost_rate`/`bill_rate`?)
- `notes`: text (YES)
- `has_receipts`: boolean (YES)
- `location_data`: jsonb (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `total_cost`: numeric (YES)
- `project_budget_item_id`: uuid (YES) (FK to `project_budget_items.id`)
- `cost_rate`: numeric (YES)
- `bill_rate`: numeric (YES)
- `total_billable`: numeric (YES)

### `change_orders` (Primary)

- `id`: uuid (NO)
- `entity_type`: text (NO) (e.g., 'PROJECT', 'WORK_ORDER')
- `entity_id`: text (NO) (FK to `projects.projectid` or `maintenance_work_orders.work_order_id`)
- `title`: text (NO)
- `description`: text (YES)
- `requested_by`: text (YES)
- `requested_date`: timestamp with time zone (YES)
- `approved_by`: text (YES)
- `approved_date`: timestamp with time zone (YES)
- `approval_notes`: text (YES)
- `total_amount`: numeric (YES) (Likely Selling Price Impact)
- `cost_impact`: numeric (NO)
- `revenue_impact`: numeric (NO)
- `impact_days`: integer (YES)
- `original_completion_date`: timestamp with time zone (YES)
- `new_completion_date`: timestamp with time zone (YES)
- `change_order_number`: text (YES)
- `document_id`: uuid (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)

### `employees`

- `employee_id`: uuid (NO)
- `first_name`: text (NO)
- `last_name`: text (NO)
- `email`: text (YES)
- `phone`: text (YES)
- `role`: text (YES)
- `hourly_rate`: numeric (YES) (Potentially deprecated by `cost_rate`/`bill_rate`?)
- `status`: text (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)
- `cost_rate`: numeric (YES)
- `bill_rate`: numeric (YES)
- `default_bill_rate`: boolean (YES)

### `project_budget_items`

- `id`: uuid (NO)
- `project_id`: text (NO) (FK to `projects.projectid`)
- `category`: text (NO) (Potentially relates to `cost_categories.name`?)
- `description`: text (YES)
- `estimated_amount`: numeric (NO) (Revenue?)
- `actual_amount`: numeric (YES) (Cost?)
- `created_at`: timestamp with time zone (YES)
- `updated_at`: timestamp with time zone (YES)
- `estimated_cost`: numeric (YES)
- `estimate_item_origin_id`: uuid (YES)
- `change_order_id`: uuid (YES) (FK to `change_orders.id`)
- `base_cost`: numeric (YES)
- `markup_percentage`: numeric (YES)
- `markup_amount`: numeric (YES)
- `selling_unit_price`: numeric (YES)
- `selling_total_price`: numeric (YES)
- `gross_margin_percentage`: numeric (YES)
- `gross_margin_amount`: numeric (YES)
- `quantity`: numeric (YES)
- `cost_code_id`: uuid (YES) (FK to `cost_codes.cost_code_id`)
- `category_id`: uuid (YES) (FK to `cost_categories.category_id`)
- `vendor_id`: text (YES) (FK to `vendors.vendorid`)
- `subcontractor_id`: text (YES) (FK to `subcontractors.subid`)
- `is_contingency`: boolean (YES)
- `document_id`: uuid (YES)

### `contacts`

- `id`: uuid (NO)
- `contact_type`: text (NO) (e.g., 'client', 'customer', 'supplier', 'subcontractor', 'employee')
- `name`: text (NO)
- `email`: text (YES)
- `phone`: text (YES)
- `company`: text (YES)
- `role`: text (YES)
- `address`: text (YES)
- `city`: text (YES)
- `state`: text (YES)
- `zip`: text (YES)
- `status`: text (YES)
- `notes`: text (YES)
- `specialty`: text (YES)
- `hourly_rate`: numeric (YES)
- `materials`: text (YES)
- `rating`: integer (YES)
- `last_contact`: timestamp with time zone (YES)
- `created_at`: timestamp with time zone (NO)
- `updated_at`: timestamp with time zone (NO)

---

_Note: `(YES)` means nullable, `(NO)` means not nullable._
_Note: Foreign Key (FK) relationships are inferred based on naming conventions and context, may need validation._
_Note: `project_change_orders` and `project_expenses` details omitted as `change_orders` and `expenses` are preferred._
